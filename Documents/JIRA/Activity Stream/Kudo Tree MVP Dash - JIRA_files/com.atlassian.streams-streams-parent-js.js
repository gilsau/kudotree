;/* module-key = 'com.atlassian.streams:streams-parent-js', location = '/js/activity-streams-parent.js' */
var ActivityStreams=ActivityStreams||(function(){var D={},B,E="/plugins/servlet/streams",I=new gadgets.Prefs(),K={dateFormat:"",dateTimeFormat:"",timeFormat:""};function G(W,V,Y){var U=W?W.split(" "):[];for(var T=0,S=U.length;T<S;T++){var X=U[T];if(D[X]){D[X].push({element:V,sortBy:Y});D[X].sort(function(c,Z){if(c.sortBy<Z.sortBy){return -1}else{return 1}})}else{D[X]=[{element:V,sortBy:Y}]}}}function M(S,T){if(AJS.$.isArray(T)){T=(S=="username")?T.join(","):T.join("|")}I.set(S,encodeURIComponent(T))}function R(S){return decodeURIComponent(gadgets.util.unescapeString(I.getString(S)))}function L(S){return I.getArray(S)}function J(S){var T=I.getMsg(S);if(T.search(/{[0-9]+}/)<0){return T}return T.replace(/''/g,"'").replace(/'/g,"''")}function N(T){var S=B+E;S+=(S.indexOf("?")==-1)?"?":"&";S+=AJS.$.param(T);return S}function C(V,S){V+="";var W,T;S=S.toUpperCase();V=V.indexOf(" ")!=-1?V.split(" "):[V];if(S=="BETWEEN"&&V.length==1){V[1]=V[0]}for(var U=0;U<V.length;U++){T=parseInt(V[U]);if(S=="AFTER"||(S=="BETWEEN"&&U==1)){T+=(1000*60*60*24-1)}V[U]=T}return V.join(" ")}function H(X){var W=X.value,S=X.operator,V=X.type;if(AJS.$.isArray(W)){var T=[];for(var U=0,Y=W.length;U<Y;U++){T.push(W[U].replace(/_/g,"\\_").replace(/ /g,"_"))}W=T.join(" ")}if(V==="date"){if(S==="is"){S="between"}W=C(W,S)}else{if(V==="list"||V==="user"){W=W.replace(/,/g," ");W=W.replace(/_/g,"\\_")}}return{value:W,operator:S}}function A(V,W,X,T){X=X||50;T=T||1000;var U,S;S=function(Z,Y){S.t=setTimeout(function(){clearTimeout(S.t);S.t=undefined;Z&&Z()},Y)};S(function(){if(!U){V();S(function(){if(U){U()}},T)}},X);return function(){U=W;if(!S.t){U()}}}function F(U,S){var T=function(){U.addClass("loading")},V=function(){U.removeClass("loading")};S=S||50;return A(T,V,S,500)}function P(){var S=Date.CultureInfo;return P.defaults=P.defaults||(S&&{dayNames:S.dayNames,dayNamesShort:S.abbreviatedDayNames,dayNamesMin:S.shortestDayNames,monthNames:S.monthNames,monthNamesShort:S.abbreviatedMonthNames,dateFormat:S.formatPatterns.shortDate.replace("yyyy","yy"),showMonthAfterYear:S.dateElementOrder.charAt(0)==="y",showOn:"focus",currentText:J("gadget.activity.stream.config.datepicker.today"),nextText:J("gadget.activity.stream.config.datepicker.next"),prevText:J("gadget.activity.stream.config.datepicker.previous"),closeText:J("gadget.activity.stream.config.datepicker.close"),buttonText:"..."})||{}}function O(){delete P.defaults}function Q(S){if(AJS.messages&&AJS.messages.makeCloseable){return }S.each(function(U){var T=AJS.$(this),V=AJS.$('<span class="aui-icon icon-close"></span>');V.click(function(){T.trigger("messageClose",[this]).remove()});T.append(V);T.addClass("closeable")})}return{getActions:function(V){var W=D[V]||[],T=[];for(var U=0,S=W.length;U<S;U++){T.push(W[U].element)}return T},setBaseUrl:function(S){B=S},getBaseUrl:function(){return B},setServletPath:function(S){E=S},getServletPath:function(){return E},getPrefs:function(){return I},registerAction:G,setPref:M,getPref:R,getPrefArray:L,getMsg:J,getStreamUrl:N,getDateValue:C,handleSpecialCases:H,showThrobber:F,getDatepickerDefaults:P,resetDatepickerDefaults:O,getDatePrefs:function(){return K},getDateFormat:function(){return K.dateFormat},getDateTimeFormat:function(){return K.dateTimeFormat},getTimeFormat:function(){return K.timeFormat},getDateRelativize:function(){return K.dateRelativize},setDatePrefs:function(S){AJS.$.extend(K,S);AJS.Date.setTimeFormat(K.timeFormat)},makeMessageCloseable:Q}})();;
;/* module-key = 'com.atlassian.streams:streams-parent-js', location = '/js/applinks.js' */
var ActivityStreamsApplinks=ActivityStreamsApplinks||(function(){var B={},A={};var N="com_atlassian_applinks_authentication";var O=/[&"'<>]/g;function L(P){switch(P){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&#39;";default:return"&quot;"}}function E(P){return P.replace(O,L)}function D(Q,V,U,P,R){if(V in B){var S=B[V];if(U){S.authAdminUri=P;delete B[V]}I(S,U)}if(!R&&parent&&(parent!==window)){var T=window;AJS.$("iframe",parent.document.body).each(function(W,Y){var X=Y.contentWindow;if(X!==T){if(X.AJS&&X.AJS.$){X.AJS.$(X.document).trigger("applinks.auth.completion",[V,U,P,true])}}})}}function C(){if(parent&&!(parent===window)){parent.ActivityStreamsApplinks=parent.ActivityStreamsApplinks||{}}AJS.$(document).bind("applinks.auth.completion",D);K()}function F(){if(window===parent.window){return null}var Q=null,P=window;AJS.$("iframe",parent.document.body).each(function(R){if(this.contentWindow.window===P){Q=this}});return Q}function I(P,S){var R=AJS.$(document);if(S){var Q=function(T){if(T.isDefaultPrevented()){M(P)}else{G(P);document.location.reload(true)}};R.bind("applinks.auth.approved",Q);R.trigger("applinks.auth.approved",P);R.unbind("applinks.auth.approved",Q)}else{R.trigger("applinks.auth.denied",P)}}function J(Q,P){var R=Q.find("a.applink-authenticate");if(Q.hasClass("aui-message")){ActivityStreams.makeMessageCloseable(Q)}R.click(function(S){window.open(P.authUri,N);S.preventDefault()});B[P.id]=P;return Q}function H(P){var Q=AJS.$("<li></li>");Q.append(AJS.format(ActivityStreams.getMsg("gadget.activity.stream.auth.request.message"),E(P.authUri),E(P.appUri),E(P.appName)));J(Q,P);return Q}function G(P){var Q=F();if((!Q)||(!Q.id)){return }if(!parent.ActivityStreamsApplinks.pendingConfirmations){parent.ActivityStreamsApplinks.pendingConfirmations={}}if(!(Q.id in parent.ActivityStreamsApplinks.pendingConfirmations)){parent.ActivityStreamsApplinks.pendingConfirmations[Q.id]=[]}parent.ActivityStreamsApplinks.pendingConfirmations[Q.id].push(P);return }function K(){if(parent&&parent.ActivityStreamsApplinks&&parent.ActivityStreamsApplinks.pendingConfirmations){var Q=F();if(Q){if(Q.id in parent.ActivityStreamsApplinks.pendingConfirmations){var R=parent.ActivityStreamsApplinks.pendingConfirmations[Q.id];delete parent.ActivityStreamsApplinks.pendingConfirmations[Q.id];for(var P=0,S=R.length;P<S;P++){M(R[P])}}}}}function M(R){var S=AJS.$(document),Q=AJS.$('<div class="aui-message success closeable shadowed applinks-auth-confirmation"><p><span class="aui-icon icon-applinks-key-success"></span></p></div>'),P=S.find("div.applinks-auth-confirmation-container");if(!P.length){P=S.find("body")}Q.append(AJS.format(ActivityStreams.getMsg("gadget.activity.stream.auth.confirmation"),E(R.appUri),E(R.appName),E(R.authAdminUri)));ActivityStreams.makeMessageCloseable(Q);P.prepend(Q);setTimeout(function(){Q.fadeOut(1000,function(){AJS.$(this).remove()})},5000)}AJS.$(document).ready(C);return{createAuthRequestBanner:H}})();;
